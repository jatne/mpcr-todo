"use strict";function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(e,t):void 0}}function _iterableToArray(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var mpcrTodos=document.querySelectorAll(".mpcr-todo"),countRows=function(e){var t=e.querySelector(".mpcr-todo__items");return t.children.length?Math.max.apply(null,_toConsumableArray(t.children).map(function(e){return parseInt(e.dataset.row)}))+1:1},handleUpdateTodo=function(e,t){var r=new FormData;r.append("action","update_mpcr_todo_items"),r.append("ajaxnonce",ajax_object.ajaxnonce),r.append("todo_id",t),r.append("todo_data",e),fetch(ajax_object.ajaxurl,{method:"POST",credentials:"same-origin",body:r}).then(function(e){return e.json()}).then(function(e){e&&console.log(e)}).catch(function(e){console.error(e)})},prepare=function(e){var t=_toConsumableArray(e.querySelectorAll(".mpcr-todo__items .mpcr-todo__item")).map(function(e){return{label:e.querySelector('[name="label"]').value,status:e.querySelector('[name="status"]').checked}});return JSON.stringify(t)},removeItem=function(e,t){t.querySelector('.mpcr-todo__item[data-row="'.concat(e.dataset.row,'"]')).remove(),handleUpdateTodo(prepare(t),t.dataset.todoId)},handleNewItem=function(e,t){if("Enter"!==e.key||!e.currentTarget.value)return!1;addNewItem(e.currentTarget,t)},handleExistingItems=function(e,t){"focusout"!==e.type&&"Enter"!==e.key||handleUpdateTodo(prepare(t),t.dataset.todoId),"Backspace"===e.key&&(e.currentTarget.value||removeItem(e.currentTarget,t))},addNewItem=function(e,t){var r='\n        <div class="mpcr-todo__item" data-row="'.concat(countRows(t),'">\n          <div class="mpcr-todo__status">\n            <input name="status" type="checkbox"/>\n          </div>\n          <div class="mpcr-todo__label">\n            <input name="label" type="text" value="').concat(e.value,'" data-row="').concat(countRows(t),'" />\n          </div>\n        </div>\n  ');t.querySelector(".mpcr-todo__items").insertAdjacentHTML("beforeend",r),e.value="",t.querySelectorAll('.mpcr-todo__items input[type="text"]').forEach(function(e){e.addEventListener("keyup",function(e){return handleExistingItems(e,t)}),e.addEventListener("focusout",function(e){return handleExistingItems(e,t)})}),t.querySelectorAll('.mpcr-todo__items input[type="checkbox"]').forEach(function(e){return e.addEventListener("change",function(){return handleUpdateTodo(prepare(t),t.dataset.todoId)})}),handleUpdateTodo(prepare(t),t.dataset.todoId)};mpcrTodos.forEach(function(t){var e=t.querySelector('.mpcr-todo__new input[type="text"]'),r=t.querySelectorAll('.mpcr-todo__items input[type="text"]'),n=t.querySelectorAll('.mpcr-todo__items input[type="checkbox"]');e.addEventListener("keyup",function(e){return handleNewItem(e,t)}),r.forEach(function(e){e.addEventListener("keyup",function(e){return handleExistingItems(e,t)}),e.addEventListener("focusout",function(e){return handleExistingItems(e,t)})}),n.forEach(function(e){return e.addEventListener("change",function(){handleUpdateTodo(prepare(t),t.dataset.todoId)})})});